<!DOCTYPE html>
<html lang="zh-CN">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rust 常见疑问汇总</title>
<link rel="stylesheet" href="style.css">
<h1>Rust 常见疑问汇总</h1>
<article><h2 id="binary-size"><a href="#binary-size">为什么 Rust 生成的程序体积比较大？如何最小化程序体积？</a></h2><p>有多个因素使得 Rust 在默认情况下有着相对较大的程序体积，包括了单态化、调试符号、标准库等。一般来说，Rust 偏向于为性能优化而非更小的体积。</p><p>通常使用发布模式编译（<code>--release</code>），以及（在 Linux 和 macOS 下）使用 <code>strip</code> 删除符号信息可以在一定程度上缩小程序体积。更多方法可以参考 <a href="https://github.com/johnthagen/min-sized-rust">Minimizing Rust Binary Size</a>，对这一问题有较完整的介绍。</p></article>
<article><h2 id="format-macro"><a href="#format-macro">格式化字符串的方法，如 <code>println</code>、<code>info</code> 等一般通过宏来实现，这是为什么？</a></h2><p>因为 Rust 里函数不支持变长参数，因而如果要做编译期类型检查，就必须通过宏来实现。</p></article>
<article><h2 id="futures-rel"><a href="#futures-rel">标准库的 <code>Future</code>、<code>futures</code> crate、<code>tokio</code> 和 <code>async-std</code> 等之间的关系是什么？</a></h2><p>标准库的 <a href="https://doc.rust-lang.org/std/future/trait.Future.html"><code>Future</code></a> trait 以及相关的 <a href="https://doc.rust-lang.org/std/task/struct.Context.html"><code>Context</code></a>、<a href="https://doc.rust-lang.org/std/pin/struct.Pin.html"><code>Pin</code></a>、<a href="https://doc.rust-lang.org/std/task/struct.Waker.html"><code>Waker</code></a> 等是核心。由于编译器编译异步函数（<code>async fn</code>）需要依赖它们的定义，因而它们必须被包含在标准库里。</p><p><a href="https://crates.io/crates/futures"><code>futures</code></a> 是 <code>Future</code> 的扩展，提供了许多虽不必进入标准库但依然重要的基础性的东西，比如 <a href="https://docs.rs/futures/*/futures/future/trait.FutureExt.html"><code>FutureExt</code></a>、<a href="https://docs.rs/futures/*/futures/stream/trait.StreamExt.html"><code>StreamExt</code></a> 等扩展 trait 和基础的<a href="https://docs.rs/futures/*/futures/channel/index.html">通道</a>、<a href="https://docs.rs/futures/*/futures/executor/index.html">执行器</a>实现等。</p><p><a href="https://crates.io/crates/tokio"><code>tokio</code></a> 和 <a href="https://crates.io/crates/async-std"><code>async-std</code></a> 是同一个层次的，主要提供异步运行时的实现，都依赖 <code>futures</code> 提供的元语，但因为处理的层次不同，所以可以看到一些自定义的与 <code>futures</code> 差不多的模块。</p><p>此外，虽然目前 <a href="https://docs.rs/futures/*/futures/stream/trait.Stream.html"><code>Stream</code></a> 是由 <code>futures</code> 提供的，但未来如果编译器要实现<a href="https://rust-lang.github.io/rfcs/2394-async_await.html#generators-and-streams">异步生成器</a>（async generator），这个 trait 也很可能会进入标准库，因而对其的扩展也依然放进了独立的 <code>StreamExt</code> 里。</p></article>
</html>